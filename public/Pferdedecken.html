<!DOCTYPE html>
version 3.10
<html lang="de">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pferdedecken leicht gemacht</title>
    <style>
        /* Stildefinitionen */
        * { box-sizing: border-box; }
        
        .row::after { content: ""; clear: both; display: table; }
        
        [class*="col-"] { float: left; padding: 15px; }
        .col-1 { width: 8.33%; }
        .col-2 { width: 16.66%; }
        .col-3 { width: 25%; }
        .col-4 { width: 33.33%; }
        .col-5 { width: 41.66%; }
        .col-6 { width: 50%; }
        .col-7 { width: 58.33%; }
        .col-8 { width: 66.66%; }
        .col-9 { width: 75%; }
        .col-10 { width: 83.33%; }
        .col-11 { width: 91.66%; }
        .col-12 { width: 100%; }
        
        html { font-family: "Lucida Sans", sans-serif; }
        
        .header { background-color: #008000; color: #ffffff; padding: 15px; }
        
        table { font-family: Arial, Helvetica, sans-serif; border-collapse: collapse; width: 100%; }
        td, th { border: 1px solid #ddd; padding: 8px; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        th { background-color: #008000; color: white; text-align: left; padding: 12px; }
        
    </style>
</head>
<body>
    <div class="header">
        <h1>Pferdedecken leicht gemacht</h1>
    </div>
    <div class="row">
        <div class="col-3 menu">
            <ul>
                <li>Zum Test</li>
                <li>Warum eindecken?</li>
                <li>Verschiedene Pferdedecken</li>
                <li>Quellen</li>
            </ul>
        </div>
        <div class="col-9">
            <form name="form1" id="pferdeForm">
               <table>
  <tr>
    <th>Wie ist der momentane Fellzustand Ihres Pferdes?</th>
  </tr>
  <tr>
    <td>
    <input type="radio" id="dick" name="fellzustand" value="dick">
    <label for="dick">Dichtes Winterfell (häufig vorkommend bei Kaltblütern)</label>
    </td>
  </tr>
  <tr>
    <td>
    <input type="radio" id="dünn" name="fellzustand" value="dünn">
    <label for="dünn">Dünnes Winterfell (häufig vorkommend bei Warmblütern) </label>
    </td>
  </tr>
  <tr>
    <td>
      <input type="radio" id="geschoren" name="fellzustand" value="geschoren">
      <label for="geschoren">Geschoren </label>
    </td>
  </tr>
</table>
                
<table>
  <tr>
    <th>Wie steht Ihr Pferd hauptsächlich?</th>
  </tr>
  <tr>
    <td>
    <input type="radio" id="box" name="haltung" value="box">
    <label for="box">In der Box</label>
    </td>
  </tr>
  <tr>
    <td>
    <input type="radio" id="paddock" name="haltung" value="paddock">
    <label for="paddock">Draußen auf dem Paddock</label>
    </td>
  </tr>
</table>
                
<table>
  <tr>
    <th>Wie ist der BCS (Body Conditioning Score) Ihres Pferdes? </br> (Der BCS beschreibt den Körperzustand eines Pferdes. Hier reicht eine Grobe einschätzung.)</th>
  </tr>
  <tr>
    <td>
    <input type="radio" id="gesund" name="bcs" value="gesund">
    <label for="gesund">Ein BCS größer als 3; Ein gesundes oder übergewichtiges Pferd </label>
    </td>
  </tr>
  <tr>
    <td>
    <input type="radio" id="dünn" name="bcs" value="dünn">
    <label for="dünn">Ein BCS von 3 oder kleiner; Ein dünnes, untergewichtiges Pferd </label>
    </td>
  </tr>
</table>

<table>
  <tr>
    <th>Wie viel ist Ihr Pferd aktuell im Training?</th>
  </tr>
  <tr>
    <td>
    <input type="radio" id="viel" name="training" value="viel">
    <label for="viel">Mein Pferd wird viel und regelmäßig trainiert.</label>
    </td>
  </tr>
  <tr>
    <td>
    <input type="radio" id="wenig" name="training" value="wenig">
    <label for="wenig">Meine Pferd wird nur ab und zu oder garnicht trainiert.</label>
    </td>
  </tr>
</table>

           

                <button type="button" onclick="getLocation()">Absenden</button>
                <input type="reset" value="Zurücksetzen">
            </form>
            
            <p>Dein Pferd trägt am besten:</p>
            <p id="ergebnis"></p>
            <p id="output"></p>
            <p id="fehler"></p>
            <div id="manuell"></div>
        </div>
    </div>
    <script>
        var temp, apparentTemp, witterungCode, witterungDescription;
            
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(fetchWeather, handleError);
    } else {
        document.getElementById('fehler').innerText = "Geolocation wird von diesem Browser nicht unterstützt.";
        manuelleEingabe();
    }
}

function fetchWeather(position) {
    const latitude = position.coords.latitude;
    const longitude = position.coords.longitude;
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&hourly=apparent_temperature&timezone=auto&lang=de`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            console.log(data);  // Protokolliere die gesamte Antwort zur Überprüfung
            if (data.current_weather && data.hourly) {
                temp = data.current_weather.temperature;  // Aktuelle Temperatur
                apparentTemp = data.hourly.apparent_temperature[0];  // Gefühlte Temperatur
                witterungCode = data.current_weather.weathercode;
                witterungDescription = getWeatherDescription(witterungCode);

                document.getElementById('output').innerHTML = `
                    Aktuelle Temperatur: ${temp}°C<br>
                    Gefühlte Temperatur: ${apparentTemp}°C<br>
                    Witterung: ${witterungDescription}`;
                
                auswerten();
            } else {
                document.getElementById('fehler').innerText = "Fehler beim Abrufen der Wetterdaten.";
            }
        })
        .catch(error => {
            console.error("API-Fehler:", error);  // Protokolliere den Fehler
            document.getElementById('fehler').innerText = "Fehler bei der Wetter-API.";
            manuelleEingabe();
        });
}

function handleError(error) {
    const fehlerText = {
        1: "Standortberechtigung wurde abgelehnt.",
        2: "Standort konnte nicht ermittelt werden.",
        3: "Zeitüberschreitung bei der Standortermittlung."
    };
    document.getElementById('fehler').innerText = fehlerText[error.code] || "Unbekannter Fehler.";
    manuelleEingabe();
}

function getWeatherDescription(code) {
    const descriptions = {
        0: "Klarer Himmel",
        1: "Hauptsächlich klar",
        2: "Teilweise bewölkt",
        3: "Bewölkt",
        45: "Nebel",
        48: "Reifnebel",
        51: "Leichter Nieselregen",
        53: "Moderater Nieselregen",
        55: "Starker Nieselregen",
        61: "Leichter Regen",
        63: "Moderater Regen",
        65: "Starker Regen",
        71: "Leichter Schneefall",
        73: "Moderater Schneefall",
        75: "Starker Schneefall",
        80: "Leichte Regenschauer",
        81: "Moderate Regenschauer",
        82: "Starke Regenschauer",
        95: "Gewitter",
        96: "Gewitter mit leichtem Hagel",
        99: "Gewitter mit starkem Hagel"
    };
    return descriptions[code] || "Unbekannte Witterung";
}

function manuelleEingabe() {
    const container = document.getElementById('manuell');
    if (document.getElementById('standortEingabe')) { return; }

    const input = document.createElement('input');
    input.type = 'text';
    input.id = 'standortEingabe';
    input.placeholder = 'Standort eingeben';

    const button = document.createElement('button');
    button.textContent = 'Absenden';
    button.onclick = () => {
        const standort = input.value;
        if (standort) getTemperatureForLocation(standort);
    };

    container.appendChild(input);
    container.appendChild(button);
}

function getTemperatureForLocation(location) {
    const geocodeUrl = `https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(location)}&format=json&addressdetails=1&limit=1`;

    fetch(geocodeUrl)
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                const { lat, lon } = data[0];
                fetchWeather({ coords: { latitude: lat, longitude: lon } });
            } else {
                document.getElementById('fehler').innerText = "Standort konnte nicht gefunden werden.";
            }
        })
        .catch(error => {
            console.error("Geocoding-Fehler:", error);
            document.getElementById('fehler').innerText = "Fehler bei der Geocoding-API.";
        });
}

function auswerten() {
        var Fellzustand = getFormValue("fellzustand");
        var Haltung = getFormValue("haltung");
        var BCS = getFormValue("bcs");
        var Training = getFormValue("training");
        var pferdezustand; 
    document.getElementById('output').innerHTML += `<br>Auswertung abgeschlossen: ${apparentTemp}°C, ${witterungDescription},${Fellzustand}, ${Haltung}, ${BCS}, ${Training} `;

    //unterteilung in Typ A, B & C von Pferd
    if (!Fellzustand || !Haltung || !BCS || !Training) {
                document.getElementById('fehler').innerText = "Bitte alle Felder ausfüllen!";
                return;
            }
    
    else if (Fellzustand === "dick" ) {
        if(Training ==="viel"){
            if(Haltung === "box") {
                pferdezustand = "B"; 
            }
            else{
                 pferdezustand = "B"; 
            }
        }
       else {
           if(Haltung === "box") {
                pferdezustand = "A" ; 
            }
            else{
                 pferdezustand = "B" ; 
            }
       }
    }
    else if (Fellzustand === "dünn" ) {
            if(Haltung === "box") {
                 pferdezustand = "B"; 
            }
            else{
                 pferdezustand = "C"; 
            }
    }
    else if (BCS === "dünn" || Fellzustand === "geschoren"){
        pferdezustand = "D"; 
    }

    deckenangabe(pferdezustand); 
}

function getFormValue(name) {
    const selected = document.querySelector(`input[name="${name}"]:checked`);
    return selected ? selected.value : null;
}

function deckenangabe(zustand){
    const output = document.getElementById('ergebnis');
    if (apparentTemp >= 12){
        output.innerHTML = 'keine Decke.';
    }
    else if (apparentTemp >= 6 && apparentTemp <= 11){
        if (pferdezustand === "D"){
            output.innerHTML = 'Regendecke mit einer Füllung von 0g.';
        }else if (pferdezustand === "B" || pferdezustand === "C"){
            if(witterungCode > 3) {
                output.innerHTML = 'keine Decke.';
            } else {
                output.innerHTML = 'Regendecke mit einer Füllung von 0g.';
            }
        }else {
            output.innerHTML = 'keine Decke.'; 
        }
    }
    else if (apparentTemp >=1 && apperentTemp <=5){
        if (pferdezustand === "D"){
            output.innerHTML = 'Thermodecke mit einer Füllung von 100g - 150g.';
        }else if (pferdezustand === "B"){
            output.innerHTMl = 'Thermodecke mit einer Füllung von 50g-100g.';
        }else if (pferdezustand === "C") {
            output.innerHTMl = 'Thermodecke mit einer Füllung von 100g - 150g.';
        }else{
            output.innerHTML = 'Stalldecke.'; 
        }
    }
    else if (apparentTemp >=-5 && apperentTemp <=0){
        if (pferdezustand === "D" || pferdezustand === "C"){
            output.innerHTML = 'Thermodecke mit einer Füllung von 300g.';
        }else if (pferdezustand === "B"){
            output.innerHTMl = 'Thermodecke mit einer Füllung von 200g.';
        }else{
            output.innerHTML = 'Thermodecke mit einer Füllung bis 150g.'; 
        }
    }
    else {
       if (pferdezustand === "A"){
           output.innerHTML = 'Thermodecke mit einer Füllung ab 200g.'; 
       }else {
           output.innerHTML = 'Thermodecke mit einer Füllung von 300g.';
       }
    }
}
 
    </script>
</body>
</html>

